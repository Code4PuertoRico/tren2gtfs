/**
 * Created by yamir on 6/6/13.
 */

 agency_id = 'TREN'
 agency_name = 'Tren Urbano'
 agency_url = 'www.dtop.gov.pr'
 agency_timezone = 'America/Puerto_Rico'
 agency_lang = null
 agency_phone = null
 agency_fare_url = null
 /********/
 stops = []
 sagrado_corazon = new Stop(
          codeName: "sagrado_corazon",
          stopId: "16",
          stopCode: "",
          stopName: "Sagrado Coraz\u00F3n",
          stopDesc: "",
          stopLat:"-66.05968D",
          stopLon: "18.437642D",
          zoneId: "",
          stopUrl: "",
          locationType: "",
          parentStation: "",
          stopTimezone: "",
          wheelchairBoarding: ""
  )

hato_rey = new Stop(
        codeName: "hato_rey",
        stopId: "15",
        stopCode: "",
        stopName: "Hato Rey",
        stopDesc: "",
        stopLat:"-66.059985D",
        stopLon: "18.430277D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)

roosevelt = new Stop(
        codeName: "roosevelt",
        stopId: "14",
        stopCode: "",
        stopName: "Roosevelt",
        stopDesc: "",
        stopLat:"-66.058779D",
        stopLon: "18.424528D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)

domenech = new Stop(
        codeName: "domenech",
        stopId: "13",
        stopCode: "",
        stopName: "D\u00F3menech",
        stopDesc: "",
        stopLat:"-66.056338D",
        stopLon: "18.416346D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)

pinero = new Stop(
        codeName: "pinero",
        stopId: "12",
        stopCode: "",
        stopName: "Pi\u00F1ero",
        stopDesc: "",
        stopLat:"-66.055225D",
        stopLon: "18.411693D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)

universidad = new Stop(
        codeName: "universidad",
        stopId: "11",
        stopCode: "",
        stopName: "Universidad",
        stopDesc: "",
        stopLat:"-66.05193D",
        stopLon: "18.406024D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)

rio_piedras = new Stop (
        codeName: "rio_piedras",
        stopId: "10",
        stopCode: "",
        stopName: "Cupey",
        stopDesc: "",
        stopLat:"-66.063209D",
        stopLon: "18.392124D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)
cupey = new Stop (
        codeName: "cupey",
        stopId: "9",
        stopCode: "",
        stopName: "R\u00EDo Piedras",
        stopDesc: "",
        stopLat:"-66.052413D",
        stopLon: "18.400251D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)

centro_medico = new Stop (
        codeName: "centro_medico",
        stopId: "8",
        stopCode: "",
        stopName: "Centro M\u00E9dico",
        stopDesc: "",
        stopLat:"-66.075734D",
        stopLon: "18.393167D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)

san_francisco = new Stop (
        codeName: "san_francisco",
        stopId: "7",
        stopCode: "",
        stopName: "San Francisco",
        stopDesc: "",
        stopLat:"-66.084036D",
        stopLon: "18.392307D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)

las_lomas = new Stop (
        codeName: "las_lomas",
        stopId: "6",
        stopCode: "",
        stopName: "Las Lomas",
        stopDesc: "",
        stopLat:"-66.095176D",
        stopLon: "18.392398D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)

martinez_nadal = new Stop (
        codeName: "martinez_nadal",
        stopId: "5",
        stopCode: "",
        stopName: "Mart\u00EDnez Nadal",
        stopDesc: "",
        stopLat:"-66.102911D",
        stopLon: "18.392811D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)

torrimar = new Stop (
        codeName: "torrimar",
        stopId: "4",
        stopCode: "",
        stopName: "Torrimar",
        stopDesc: "",
        stopLat:"-66.120175D",
        stopLon: "18.393597D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)


jardines = new Stop (
        codeName: "jardines",
        stopId: "3",
        stopCode: "",
        stopName: "Jardines",
        stopDesc: "",
        stopLat:"-66.128919D",
        stopLon: "18.395734D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)

deportivo = new Stop (
        codeName: "deportivo",
        stopId: "2",
        stopCode: "",
        stopName: "Deportivo",
        stopDesc: "",
        stopLat:"-66.151249D",
        stopLon: "18.395922D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)

bayamon = new Stop (
        codeName: "bayamon",
        stopId: "1",
        stopCode: "",
        stopName: "Bayam\u00F3n",
        stopDesc: "",
        stopLat:"-66.153815D",
        stopLon: "18.40095D",
        zoneId: "",
        stopUrl: "",
        locationType: "",
        parentStation: "",
        stopTimezone: "",
        wheelchairBoarding: ""
)

stops << sagrado_corazon
    stops << hato_rey
    stops << roosevelt
    stops << domenech
    stops << pinero
    stops << universidad
    stops << rio_piedras
    stops << cupey
    stops << centro_medico
    stops << san_francisco
    stops << las_lomas
    stops << martinez_nadal
    stops << torrimar
    stops << jardines
    stops << deportivo
    stops << bayamon

routeTrenUrbano = new Route (
    routeId: "RUTA_TREN",
    agencyId: agency_id,
    routeShortName: "",
    routeLongName: "Ruta del Tren Urbano",
    routeDesc: "Ruta del Tren Urbano de Puerto Rico",
    routeType: "1",
    routeUrl: "www.dtop.gov.pr",
    routecolor: "",
    routeTextColor: ""
)

routes = []
routes << routeTrenUrbano

 trainScheduleCsv =  'trainschedule.csv'

 agencyFileName = "agency.txt"
 stopsFileName = "stops.txt"
 routesFileName = "routes.txt"
 tripsFileName = "trips.txt"


agency = new Agency(agencyId: agency_id,
                    agencyName: agency_name,
                    agencyUrl: agency_url,
                    agencyTimezone: agency_timezone,
                    agencyLang: agency_lang,
                    agencyPhone: agency_phone,
                    agencyFareUrl: agency_fare_url)
createAgencyTxt(agency)
createStopsTxt(stops)
createRoutesTxt(routes)
createTripsTxt()



def createAgencyTxt(def agency){
    def agencyTxt = new File(agencyFileName)
    agencyTxt.newWriter()
    agencyTxt << ("agency_id, agency_name,agency_url,agency_timezone,agency_phone,agency_lang") << "\r\n"
    agencyTxt << (agency.agencyId?agency.agencyId+",":",")
    assert(agency.agencyName)
    agencyTxt << (agency.agencyName?agency.agencyName+",":",")
    assert(agency.agencyUrl)
    agencyTxt << (agency.agencyUrl?agency.agencyUrl+",":",")
    assert(agency.agencyTimezone)
    agencyTxt << (agency.agencyTimezone?agency.agencyTimezone+",":",")
    agencyTxt << (agency.agencyLang?agency.agencyLanga+",":",")
    agencyTxt << (agency.agencyPhone?agency.agencyPhone+",":",")
    agencyTxt << (agency.agencyFareUrl?agency.agencyFareUrl:"") << "\r\n"

}

def createStopsTxt(def stops){
    def stopsTxt = new File(stopsFileName)
    stopsTxt.newWriter()
    stopsTxt << ("stop_id,stop_code,stop_name,stop_desc,stop_lat,stop_lon,zone_id,stop_url,location_type,parent_station,stop_timezone,wheelchair_boarding") << "\r\n"
    stops.each { stop ->
        stopsTxt << (stop.stopId?stop.stopId+",":",")
        stopsTxt << (stop.stopCode?stop.stopCode+",":",")
        stopsTxt << (stop.stopName?stop.stopName+",":",")
        stopsTxt << (stop.stopDesc?stop.stopDesc+",":",")
        stopsTxt << (stop.stopLat?stop.stopLat+",":",")
        stopsTxt << (stop.stopLon?stop.stopLon+",":",")
        stopsTxt << (stop.zoneId?stop.zoneId+",":",")
        stopsTxt << (stop.stopUrl?stop.stopUrl+",":",")
        stopsTxt << (stop.locationType?stop.locationType+",":",")
        stopsTxt << (stop.parentStation?stop.parentStation+",":",")
        stopsTxt << (stop.stopTimezone?stop.stopTimezone+",":",")
        stopsTxt << (stop.wheelchairBoarding?stop.wheelchairBoarding:"") << "\r\n"
    }

}

def createRoutesTxt(def routes){
    def routesTxt = new File (routesFileName)
    routesTxt.newWriter()
    routesTxt << ("route_id,route_short_name,route_long_name,route_desc,route_type") << "\r\n"
    routes.each { route ->
        routesTxt << (route.routeId?route.routeId+",":",")
        routesTxt << (route.agencyId?route.agencyId+",":",")
        routesTxt << (route.routeShortName?route.routeShortName+",":",")
        routesTxt << (route.routeLongName?route.routeLongName+",":",")
        routesTxt << (route.routeDesc?route.routeDesc+",":",")
        routesTxt << (route.routeType?route.routeType+",":",")
        routesTxt << (route.routeUrl?route.routeUrl+",":",")
        routesTxt << (route.routecolor?route.routecolor+",":",")
        routesTxt << (route.routeTextColor?route.routeTextColor+",":",") << "\r\n"
    }

}

/*
    route_id,service_id,trip_id,trip_headsign,trip_short_name,direction_id,block_id,shape_id,wheelchair_accessible
RUTA_TREN,LOW_SEASON_WORKDAY,RTLSW1,"to Airport",0
 */

Stop getStopFromNumber(int i){
    stops.find{stop -> if(stop.stopId == "${i}") return stop}
}

def createTripsTxt(){
    def printTrip = {theFile, trip ->
        theFile << trip.route_id+","
        theFile << trip.service_id+","
        theFile << trip.trip_id+","
        theFile << trip.trip_headsign+","
        theFile << trip.trip_short_name+","
        theFile << trip.direction_id+","
        theFile << trip.shape_id+","
        theFile << trip.wheelchair_accessible+","
        theFile << "\r\n"

    }

    def trips = []

    int count = 0;
    for(int startId=1; startId<= stops.size(); startId++){
        Stop theStart = getStopFromNumber(startId)
        if(startId < stops.size()){
            for (int stopId=startId+1; stopId<=stops.size(); stopId++){
                Stop theStop = getStopFromNumber(stopId)
                Trip trip = new Trip();
                trip.route_id = ((Route) routes[0]).routeId
                trip.service_id = "LOW_SEASON_WORKDAY"
                trip.trip_id = "${++count}"
                trip.trip_headsign = theStop.stopName
                trip.trip_short_name = "${theStart.stopName} / ${theStop.stopName}"
                trip.direction_id = "0"
                trip.block_id = ""
                trip.shape_id = ""
                trip.wheelchair_accessible = ""
                trips << trip
            }
        }
        if(startId > 1){
            for (int stopId = startId -1; stopId >=1; stopId--){
                Stop theStop = getStopFromNumber(stopId)
                Trip trip = new Trip();
                trip.route_id = ((Route) routes[0]).routeId
                trip.service_id = "LOW_SEASON_WORKDAY"
                trip.trip_id = "${++count}"
                trip.trip_headsign = theStop.stopName
                trip.trip_short_name = "${theStart.stopName} / ${theStop.stopName}"
                trip.direction_id = "1"
                trip.block_id = ""
                trip.shape_id = ""
                trip.wheelchair_accessible = ""
                trips << trip
            }
        }
    }

    def tripsTxt = new File (tripsFileName)
    tripsTxt.newWriter()

    tripsTxt << ("route_id,service_id,trip_id,trip_headsign,trip_short_name,direction_id,block_id,shape_id,wheelchair_accessible") << '\r\n'

    for(Trip t: trips){
        printTrip.call(tripsTxt,t)
    }
}


class Agency {
    String agencyId
    String agencyName
    String agencyUrl
    String agencyTimezone
    String agencyLang
    String agencyPhone
    String agencyFareUrl
}

class Stop {
    String codeName
    String stopId
    String stopCode
    String stopName
    String stopDesc
    String stopLat
    String stopLon
    String zoneId
    String stopUrl
    String locationType
    String parentStation
    String stopTimezone
    String wheelchairBoarding
}

class Route {
    String routeId
    String agencyId
    String routeShortName
    String routeLongName
    String routeDesc
    String routeType
    String routeUrl
    String routecolor
    String routeTextColor
}

class Trip {
    String route_id
    String service_id
    String trip_id
    String trip_headsign
    String trip_short_name
    String direction_id
    String block_id
    String shape_id
    String wheelchair_accessible
}